biopopgrowth_distribute_surplus_effect = {
    biopopgrowth_calculate_bp_growth = yes

    if = {
        limit = {
            check_variable = {
                which = bp_growth
                value <= 5
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_5 days = 365
        }
    }
    
    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 5
                }
                check_variable = {
                    which = bp_growth
                    value <= 10
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_10 days = 365
        }
    }

    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 10
                }
                check_variable = {
                    which = bp_growth
                    value <= 15
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_15 days = 365
        }
    }
        
    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 15
                }
                check_variable = {
                    which = bp_growth
                    value <= 20
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_20 days = 365
        }
    }

    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 20
                }
                check_variable = {
                    which = bp_growth
                    value <= 25
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_25 days = 365
        }
    }
        
    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 25
                }
                check_variable = {
                    which = bp_growth
                    value <= 30
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_30 days = 365
        }
    }

    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 30
                }
                check_variable = {
                    which = bp_growth
                    value <= 35
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_35 days = 365
        }
    }
    
    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 35
                }
                check_variable = {
                    which = bp_growth
                    value <= 40
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_40 days = 365
        }
    }

    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 40
                }
                check_variable = {
                    which = bp_growth
                    value <= 45
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_45 days = 365
        }
    }
        
    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 45
                }
                check_variable = {
                    which = bp_growth
                    value <= 50
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_50 days = 365
        }
    }

    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 50
                }
                check_variable = {
                    which = bp_growth
                    value <= 55
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_55 days = 365
        }
    }
        
    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 55
                }
                check_variable = {
                    which = bp_growth
                    value <= 60
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_60 days = 365
        }
    }

    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 60
                }
                check_variable = {
                    which = bp_growth
                    value <= 65
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_65 days = 365
        }
    }
        
    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 65
                }
                check_variable = {
                    which = bp_growth
                    value <= 70
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_70 days = 365
        }
    }

    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 70
                }
                check_variable = {
                    which = bp_growth
                    value <= 75
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_75 days = 365
        }
    }
        
    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 75
                }
                check_variable = {
                    which = bp_growth
                    value <= 80
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_80 days = 365
        }
    }

    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 80
                }
                check_variable = {
                    which = bp_growth
                    value <= 85
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_85 days = 365
        }
    }
        
    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 85
                }
                check_variable = {
                    which = bp_growth
                    value <= 90
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_90 days = 365
        }
    }

    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 90
                }
                check_variable = {
                    which = bp_growth
                    value <= 95
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_95 days = 365
        }
    }
        
    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 95
                }
                check_variable = {
                    which = bp_growth
                    value <= 100
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_100 days = 365
        }
    }

    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 100
                }
                check_variable = {
                    which = bp_growth
                    value <= 105
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_105 days = 365
        }
    }
    
    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 105
                }
                check_variable = {
                    which = bp_growth
                    value <= 110
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_110 days = 365
        }
    }

    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 110
                }
                check_variable = {
                    which = bp_growth
                    value <= 115
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_115 days = 365
        }
    }
        
    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 115
                }
                check_variable = {
                    which = bp_growth
                    value <= 120
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_120 days = 365
        }
    }

    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 120
                }
                check_variable = {
                    which = bp_growth
                    value <= 125
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_125 days = 365
        }
    }
        
    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 125
                }
                check_variable = {
                    which = bp_growth
                    value <= 130
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_130 days = 365
        }
    }

    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 130
                }
                check_variable = {
                    which = bp_growth
                    value <= 135
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_135 days = 365
        }
    }
    
    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 135
                }
                check_variable = {
                    which = bp_growth
                    value <= 140
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_140 days = 365
        }
    }

    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 140
                }
                check_variable = {
                    which = bp_growth
                    value <= 145
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_145 days = 365
        }
    }
        
    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 145
                }
                check_variable = {
                    which = bp_growth
                    value <= 150
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_150 days = 365
        }
    }

    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 150
                }
                check_variable = {
                    which = bp_growth
                    value <= 155
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_155 days = 365
        }
    }
        
    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 155
                }
                check_variable = {
                    which = bp_growth
                    value <= 160
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_160 days = 365
        }
    }

    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 160
                }
                check_variable = {
                    which = bp_growth
                    value <= 165
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_165 days = 365
        }
    }
        
    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 165
                }
                check_variable = {
                    which = bp_growth
                    value <= 170
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_170 days = 365
        }
    }

    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 170
                }
                check_variable = {
                    which = bp_growth
                    value <= 175
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_175 days = 365
        }
    }
        
    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 175
                }
                check_variable = {
                    which = bp_growth
                    value <= 180
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_180 days = 365
        }
    }

    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 180
                }
                check_variable = {
                    which = bp_growth
                    value <= 185
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_185 days = 365
        }
    }
        
    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 185
                }
                check_variable = {
                    which = bp_growth
                    value <= 190
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_190 days = 365
        }
    }

    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 190
                }
                check_variable = {
                    which = bp_growth
                    value <= 195
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_195 days = 365
        }
    }
        
    if = {
        limit = {
            AND = {
                check_variable = {
                    which = bp_growth
                    value > 195
                }
                check_variable = {
                    which = bp_growth
                    value <= 200
                }
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_200 days = 365
        }
    }
        
    if = {
        limit = {
            check_variable = {
                which = bp_growth
                value > 200
            }
        }
        
        add_modifier = {
            modifier = biopopgrowth_distribute_surplus_200 days = 365
        }
    }
}

biopopgrowth_calculate_bp_growth = {
    biopopgrowth_calc_capacity_effect = yes
    
    set_variable = {
        which = bp_growth
        value = 0
    }
    
    planet = {
        change_variable = {
            which = bp_growth
            value = bio_pops
        }
    }
    
    planet = {
        divide_variable = {
            which = bp_growth
            value = bio_capacity
        }
    }
    
    planet = {
        multiply_variable = {
            which = bp_growth
            value = -1
        }
    }
    
    planet = {
        change_variable = {
            which = bp_growth
            value = 1
        }
    }
    
    planet = {
        multiply_variable = {
            which = bp_growth
            value = bio_pops
        }
    }
    
    planet = {
        multiply_variable = {
            which = bp_growth
            value = 3
        }
    }
}

biopopgrowth_calc_capacity_effect = {
    biopopgrowth_count_pops_effect = yes
    biopopgrowth_calc_abs_free_housing_effect = yes
    
    set_variable = {
        which = bio_capacity
        value = 0
    }
    
    planet = {
        change_variable = {
            which = bio_capacity
            value = bio_pops
        }
    }

    if = {
        limit = {
            free_housing < 0
        }

        planet = {
            subtract_variable = {
                which = bio_capacity
                value = abs_free_housing
            }
        }
    }

    if = {
        limit = {
            free_housing >= 0
        }

        planet = {
            change_variable = {
                which = bio_capacity
                value = abs_free_housing
            }
        }
    }
    
    planet = {
        multiply_variable = {
            which = bio_capacity
            value = 1.5
        }
    }
}

biopopgrowth_count_pops_effect = {
    set_variable = {
        which = bio_pops
        value = 0
    }
    
    every_owned_pop = {
        limit = {
            is_robot_pop = no
        }
        
        planet = {
            change_variable = {
                which = bio_pops
                value = 1
            }
        }
    }
}

biopopgrowth_calc_abs_free_housing_effect = {
    set_variable = {
        which = abs_free_housing
        value = free_housing
    }
    
    if = {
        limit = {
            check_variable = {
                which = abs_free_housing
                value < 0
            }
        }
        
        planet = {
            multiply_variable = {
                which = abs_free_housing
                value = -1
            }
        }
    }
}
